"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const core_1 = require("@aws-cdk/core");
const aws_redshift_1 = require("@aws-cdk/aws-redshift");
const aws_ec2_1 = require("@aws-cdk/aws-ec2");
const aws_iam_1 = require("@aws-cdk/aws-iam");
const aws_s3_1 = require("@aws-cdk/aws-s3");
const aws_glue_1 = require("@aws-cdk/aws-glue");
const uuid_1 = require("uuid");
const dotenv = require("dotenv");
dotenv.config({ path: '../.env' });
const ID_PREFIX = 'RedPandaTest';
const STACK_NAME = process.env.STACK_NAME;
const makeId = (suffix) => `${ID_PREFIX}${suffix}`;
class RedPandaTestStack extends core_1.Stack {
    constructor(scope, id) {
        super(scope, id);
        // Bucket
        const role = new aws_iam_1.Role(this, makeId('Role'), {
            assumedBy: new aws_iam_1.ServicePrincipal('redshift.amazonaws.com')
        });
        const bucket = new aws_s3_1.Bucket(this, makeId('BaseBucket'), {
            bucketName: `${STACK_NAME}-${process.env.BASE_BUCKET_ID}-${uuid_1.v4()}`,
            versioned: false,
            publicReadAccess: false,
            blockPublicAccess: aws_s3_1.BlockPublicAccess.BLOCK_ALL,
            removalPolicy: core_1.RemovalPolicy.DESTROY
        });
        bucket.grantReadWrite(role);
        // Redshift
        const vpc = new aws_ec2_1.Vpc(this, makeId('VPC'), {});
        const sg = new aws_ec2_1.SecurityGroup(this, makeId('SecurityGroup'), {
            vpc: vpc
        });
        sg.connections.allowFromAnyIpv4(aws_ec2_1.Port.tcp(5439));
        sg.node.addDependency(vpc);
        const { subnetIds } = vpc.selectSubnets({ subnetType: aws_ec2_1.SubnetType.PUBLIC });
        const subnetGroup = new aws_redshift_1.CfnClusterSubnetGroup(this, makeId('Subnets'), {
            description: 'Subnets for Redshift cluster',
            subnetIds
        });
        subnetGroup.applyRemovalPolicy(core_1.RemovalPolicy.RETAIN, {
            applyToUpdateReplacePolicy: true
        });
        const cluster = new aws_redshift_1.CfnCluster(this, makeId('Redshift'), {
            masterUsername: process.env.REDSHIFT_USERNAME || '',
            masterUserPassword: process.env.REDSHIFT_PASSWORD || '',
            dbName: process.env.REDSHIFT_DB || '',
            clusterType: 'single-node',
            port: parseInt(process.env.REDSHIFT_PORT || '5439'),
            nodeType: 'dc2.large',
            iamRoles: [role.roleArn],
            publiclyAccessible: true,
            vpcSecurityGroupIds: [sg.securityGroupId],
            clusterSubnetGroupName: subnetGroup.ref
        });
        cluster.node.addDependency(sg);
        // Glue
        const glueDB = new aws_glue_1.Database(this, makeId('GlueDB'), {
            databaseName: process.env.GLUE_DB || ''
        });
        const glueBucket = new aws_s3_1.Bucket(this, makeId('GlueBucket'), {
            bucketName: `${STACK_NAME}-${process.env.GLUE_BUCKET_ID}-${uuid_1.v4()}`,
            versioned: false,
            publicReadAccess: false,
            blockPublicAccess: aws_s3_1.BlockPublicAccess.BLOCK_ALL,
            removalPolicy: core_1.RemovalPolicy.DESTROY
        });
        new aws_glue_1.Table(this, makeId('GlueTable'), {
            bucket: glueBucket,
            database: glueDB,
            tableName: process.env.GLUE_TABLE_NAME || '',
            columns: [
                {
                    name: 'col0',
                    type: aws_glue_1.Schema.STRING
                },
                {
                    name: 'col1',
                    type: aws_glue_1.Schema.STRING
                }
            ],
            dataFormat: aws_glue_1.DataFormat.CSV
        });
        // Athena
        new aws_s3_1.Bucket(this, makeId('AthenaBucket'), {
            bucketName: `${STACK_NAME}-${process.env.ATHENA_BUCKET_ID}-${uuid_1.v4()}`,
            versioned: false,
            publicReadAccess: false,
            blockPublicAccess: aws_s3_1.BlockPublicAccess.BLOCK_ALL,
            removalPolicy: core_1.RemovalPolicy.DESTROY
        });
    }
}
exports.RedPandaTestStack = RedPandaTestStack;
const app = new core_1.App();
new RedPandaTestStack(app, 'RedPandaTestStack');
app.synth();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHdDQUF5RDtBQUN6RCx3REFBeUU7QUFDekUsOENBQXVFO0FBQ3ZFLDhDQUF5RDtBQUN6RCw0Q0FBMkQ7QUFDM0QsZ0RBQXVFO0FBQ3ZFLCtCQUFtQztBQUNuQyxpQ0FBZ0M7QUFFaEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFBO0FBRWxDLE1BQU0sU0FBUyxHQUFHLGNBQWMsQ0FBQTtBQUNoQyxNQUFNLFVBQVUsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQTtBQUV6QyxNQUFNLE1BQU0sR0FBRyxDQUFDLE1BQWMsRUFBRSxFQUFFLENBQUMsR0FBRyxTQUFTLEdBQUcsTUFBTSxFQUFFLENBQUE7QUFFMUQsTUFBYSxpQkFBa0IsU0FBUSxZQUFLO0lBQzFDLFlBQVksS0FBVSxFQUFFLEVBQVU7UUFDaEMsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQTtRQUVoQixTQUFTO1FBQ1QsTUFBTSxJQUFJLEdBQUcsSUFBSSxjQUFJLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUMxQyxTQUFTLEVBQUUsSUFBSSwwQkFBZ0IsQ0FBQyx3QkFBd0IsQ0FBQztTQUMxRCxDQUFDLENBQUE7UUFFRixNQUFNLE1BQU0sR0FBRyxJQUFJLGVBQU0sQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLFlBQVksQ0FBQyxFQUFFO1lBQ3BELFVBQVUsRUFBRSxHQUFHLFVBQVUsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsSUFBSSxTQUFNLEVBQUUsRUFBRTtZQUNyRSxTQUFTLEVBQUUsS0FBSztZQUNoQixnQkFBZ0IsRUFBRSxLQUFLO1lBQ3ZCLGlCQUFpQixFQUFFLDBCQUFpQixDQUFDLFNBQVM7WUFDOUMsYUFBYSxFQUFFLG9CQUFh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Q0FBQyxlQUFlLElBQUksRUFBRTtZQUM1QyxPQUFPLEVBQUU7Z0JBQ1A7b0JBQ0UsSUFBSSxFQUFFLE1BQU07b0JBQ1osSUFBSSxFQUFFLGlCQUFNLENBQUMsTUFBTTtpQkFDcEI7Z0JBQ0Q7b0JBQ0UsSUFBSSxFQUFFLE1BQU07b0JBQ1osSUFBSSxFQUFFLGlCQUFNLENBQUMsTUFBTTtpQkFDcEI7YUFDRjtZQUNELFVBQVUsRUFBRSxxQkFBVSxDQUFDLEdBQUc7U0FDM0IsQ0FBQyxDQUFBO1FBRUYsU0FBUztRQUNULElBQUksZUFBTSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsY0FBYyxDQUFDLEVBQUU7WUFDdkMsVUFBVSxFQUFFLEdBQUcsVUFBVSxJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLElBQUksU0FBTSxFQUFFLEVBQUU7WUFDdkUsU0FBUyxFQUFFLEtBQUs7WUFDaEIsZ0JBQWdCLEVBQUUsS0FBSztZQUN2QixpQkFBaUIsRUFBRSwwQkFBaUIsQ0FBQyxTQUFTO1lBQzlDLGFBQWEsRUFBRSxvQkFBYSxDQUFDLE9BQU87U0FDckMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztDQUNGO0FBN0ZELDhDQTZGQztBQUVELE1BQU0sR0FBRyxHQUFHLElBQUksVUFBRyxFQUFFLENBQUE7QUFDckIsSUFBSSxpQkFBaUIsQ0FBQyxHQUFHLEVBQUUsbUJBQW1CLENBQUMsQ0FBQTtBQUMvQyxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHAsIFN0YWNrLCBSZW1vdmFsUG9saWN5IH0gZnJvbSAnQGF3cy1jZGsvY29yZSdcbmltcG9ydCB7IENmbkNsdXN0ZXIsIENmbkNsdXN0ZXJTdWJuZXRHcm91cCB9IGZyb20gJ0Bhd3MtY2RrL2F3cy1yZWRzaGlmdCdcbmltcG9ydCB7IFZwYywgU2VjdXJpdHlHcm91cCwgUG9ydCwgU3VibmV0VHlwZSB9IGZyb20gJ0Bhd3MtY2RrL2F3cy1lYzInXG5pbXBvcnQgeyBSb2xlLCBTZXJ2aWNlUHJpbmNpcGFsIH0gZnJvbSAnQGF3cy1jZGsvYXdzLWlhbSdcbmltcG9ydCB7IEJ1Y2tldCwgQmxvY2tQdWJsaWNBY2Nlc3MgfSBmcm9tICdAYXdzLWNkay9hd3MtczMnXG5pbXBvcnQgeyBEYXRhYmFzZSwgVGFibGUsIFNjaGVtYSwgRGF0YUZvcm1hdCB9IGZyb20gJ0Bhd3MtY2RrL2F3cy1nbHVlJ1xuaW1wb3J0IHsgdjQgYXMgdXVpZHY0IH0gZnJvbSAndXVpZCdcbmltcG9ydCAqIGFzIGRvdGVudiBmcm9tICdkb3RlbnYnXG5cbmRvdGVudi5jb25maWcoeyBwYXRoOiAnLi4vLmVudicgfSlcblxuY29uc3QgSURfUFJFRklYID0gJ1JlZFBhbmRhVGVzdCdcbmNvbnN0IFNUQUNLX05BTUUgPSBwcm9jZXNzLmVudi5TVEFDS19OQU1FXG5cbmNvbnN0IG1ha2VJZCA9IChzdWZmaXg6IHN0cmluZykgPT4gYCR7SURfUFJFRklYfSR7c3VmZml4fWBcblxuZXhwb3J0IGNsYXNzIFJlZFBhbmRhVGVzdFN0YWNrIGV4dGVuZHMgU3RhY2sge1xuICBjb25zdHJ1Y3RvcihzY29wZTogQXBwLCBpZDogc3RyaW5nKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkKVxuXG4gICAgLy8gQnVja2V0XG4gICAgY29uc3Qgcm9sZSA9IG5ldyBSb2xlKHRoaXMsIG1ha2VJZCgnUm9sZScpLCB7XG4gICAgICBhc3N1bWVkQnk6IG5ldyBTZXJ2aWNlUHJpbmNpcGFsKCdyZWRzaGlmdC5hbWF6b25hd3MuY29tJylcbiAgICB9KVxuXG4gICAgY29uc3QgYnVja2V0ID0gbmV3IEJ1Y2tldCh0aGlzLCBtYWtlSWQoJ0Jhc2VCdWNrZXQnKSwge1xuICAgICAgYnVja2V0TmFtZTogYCR7U1RBQ0tfTkFNRX0tJHtwcm9jZXNzLmVudi5CQVNFX0JVQ0tFVF9JRH0tJHt1dWlkdjQoKX1gLFxuICAgICAgdmVyc2lvbmVkOiBmYWxzZSxcbiAgICAgIHB1YmxpY1JlYWRBY2Nlc3M6IGZhbHNlLFxuICAgICAgYmxvY2tQdWJsaWNBY2Nlc3M6IEJsb2NrUHVibGljQWNjZXNzLkJMT0NLX0FMTCxcbiAgICAgIHJlbW92YWxQb2xpY3k6IFJlbW92YWxQb2xpY3kuREVTVFJPWVxuICAgIH0pXG5cbiAgICBidWNrZXQuZ3JhbnRSZWFkV3JpdGUocm9sZSlcblxuICAgIC8vIFJlZHNoaWZ0XG4gICAgY29uc3QgdnBjID0gbmV3IFZwYyh0aGlzLCBtYWtlSWQoJ1ZQQycpLCB7fSlcblxuICAgIGNvbnN0IHNnID0gbmV3IFNlY3VyaXR5R3JvdXAodGhpcywgbWFrZUlkKCdTZWN1cml0eUdyb3VwJyksIHtcbiAgICAgIHZwYzogdnBjXG4gICAgfSlcblxuICAgIHNnLmNvbm5lY3Rpb25zLmFsbG93RnJvbUFueUlwdjQoUG9ydC50Y3AoNTQzOSkpXG4gICAgc2cubm9kZS5hZGREZXBlbmRlbmN5KHZwYylcblxuICAgIGNvbnN0IHsgc3VibmV0SWRzIH0gPSB2cGMuc2VsZWN0U3VibmV0cyh7IHN1Ym5ldFR5cGU6IFN1Ym5ldFR5cGUuUFVCTElDIH0pXG4gICAgY29uc3Qgc3VibmV0R3JvdXAgPSBuZXcgQ2ZuQ2x1c3RlclN1Ym5ldEdyb3VwKHRoaXMsIG1ha2VJZCgnU3VibmV0cycpLCB7XG4gICAgICBkZXNjcmlwdGlvbjogJ1N1Ym5ldHMgZm9yIFJlZHNoaWZ0IGNsdXN0ZXInLFxuICAgICAgc3VibmV0SWRzXG4gICAgfSlcblxuICAgIHN1Ym5ldEdyb3VwLmFwcGx5UmVtb3ZhbFBvbGljeShSZW1vdmFsUG9saWN5LlJFVEFJTiwge1xuICAgICAgYXBwbHlUb1VwZGF0ZVJlcGxhY2VQb2xpY3k6IHRydWVcbiAgICB9KVxuXG4gICAgY29uc3QgY2x1c3RlciA9IG5ldyBDZm5DbHVzdGVyKHRoaXMsIG1ha2VJZCgnUmVkc2hpZnQnKSwge1xuICAgICAgbWFzdGVyVXNlcm5hbWU6IHByb2Nlc3MuZW52LlJFRFNISUZUX1VTRVJOQU1FIHx8ICcnLFxuICAgICAgbWFzdGVyVXNlclBhc3N3b3JkOiBwcm9jZXNzLmVudi5SRURTSElGVF9QQVNTV09SRCB8fCAnJyxcbiAgICAgIGRiTmFtZTogcHJvY2Vzcy5lbnYuUkVEU0hJRlRfREIgfHwgJycsXG4gICAgICBjbHVzdGVyVHlwZTogJ3NpbmdsZS1ub2RlJyxcbiAgICAgIHBvcnQ6IHBhcnNlSW50KHByb2Nlc3MuZW52LlJFRFNISUZUX1BPUlQgfHwgJzU0MzknKSxcbiAgICAgIG5vZGVUeXBlOiAnZGMyLmxhcmdlJyxcbiAgICAgIGlhbVJvbGVzOiBbcm9sZS5yb2xlQXJuXSxcbiAgICAgIHB1YmxpY2x5QWNjZXNzaWJsZTogdHJ1ZSxcbiAgICAgIHZwY1NlY3VyaXR5R3JvdXBJZHM6IFtzZy5zZWN1cml0eUdyb3VwSWRdLFxuICAgICAgY2x1c3RlclN1Ym5ldEdyb3VwTmFtZTogc3VibmV0R3JvdXAucmVmXG4gICAgfSlcblxuICAgIGNsdXN0ZXIubm9kZS5hZGREZXBlbmRlbmN5KHNnKVxuXG4gICAgLy8gR2x1ZVxuICAgIGNvbnN0IGdsdWVEQiA9IG5ldyBEYXRhYmFzZSh0aGlzLCBtYWtlSWQoJ0dsdWVEQicpLCB7XG4gICAgICBkYXRhYmFzZU5hbWU6IHByb2Nlc3MuZW52LkdMVUVfREIgfHwgJydcbiAgICB9KVxuXG4gICAgY29uc3QgZ2x1ZUJ1Y2tldCA9IG5ldyBCdWNrZXQodGhpcywgbWFrZUlkKCdHbHVlQnVja2V0JyksIHtcbiAgICAgIGJ1Y2tldE5hbWU6IGAke1NUQUNLX05BTUV9LSR7cHJvY2Vzcy5lbnYuR0xVRV9CVUNLRVRfSUR9LSR7dXVpZHY0KCl9YCxcbiAgICAgIHZlcnNpb25lZDogZmFsc2UsXG4gICAgICBwdWJsaWNSZWFkQWNjZXNzOiBmYWxzZSxcbiAgICAgIGJsb2NrUHVibGljQWNjZXNzOiBCbG9ja1B1YmxpY0FjY2Vzcy5CTE9DS19BTEwsXG4gICAgICByZW1vdmFsUG9saWN5OiBSZW1vdmFsUG9saWN5LkRFU1RST1lcbiAgICB9KVxuXG4gICAgbmV3IFRhYmxlKHRoaXMsIG1ha2VJZCgnR2x1ZVRhYmxlJyksIHtcbiAgICAgIGJ1Y2tldDogZ2x1ZUJ1Y2tldCxcbiAgICAgIGRhdGFiYXNlOiBnbHVlREIsXG4gICAgICB0YWJsZU5hbWU6IHByb2Nlc3MuZW52LkdMVUVfVEFCTEVfTkFNRSB8fCAnJyxcbiAgICAgIGNvbHVtbnM6IFtcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdjb2wwJyxcbiAgICAgICAgICB0eXBlOiBTY2hlbWEuU1RSSU5HXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnY29sMScsXG4gICAgICAgICAgdHlwZTogU2NoZW1hLlNUUklOR1xuICAgICAgICB9XG4gICAgICBdLFxuICAgICAgZGF0YUZvcm1hdDogRGF0YUZvcm1hdC5DU1ZcbiAgICB9KVxuXG4gICAgLy8gQXRoZW5hXG4gICAgbmV3IEJ1Y2tldCh0aGlzLCBtYWtlSWQoJ0F0aGVuYUJ1Y2tldCcpLCB7XG4gICAgICBidWNrZXROYW1lOiBgJHtTVEFDS19OQU1FfS0ke3Byb2Nlc3MuZW52LkFUSEVOQV9CVUNLRVRfSUR9LSR7dXVpZHY0KCl9YCxcbiAgICAgIHZlcnNpb25lZDogZmFsc2UsXG4gICAgICBwdWJsaWNSZWFkQWNjZXNzOiBmYWxzZSxcbiAgICAgIGJsb2NrUHVibGljQWNjZXNzOiBCbG9ja1B1YmxpY0FjY2Vzcy5CTE9DS19BTEwsXG4gICAgICByZW1vdmFsUG9saWN5OiBSZW1vdmFsUG9saWN5LkRFU1RST1lcbiAgICB9KVxuICB9XG59XG5cbmNvbnN0IGFwcCA9IG5ldyBBcHAoKVxubmV3IFJlZFBhbmRhVGVzdFN0YWNrKGFwcCwgJ1JlZFBhbmRhVGVzdFN0YWNrJylcbmFwcC5zeW50aCgpXG4iXX0=